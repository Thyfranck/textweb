<div class="span12 well">
  <%= render "courses/description_index" %>


  <div class="span9 well">

    <div class="row-fluid">
      <div class="span11">
        <div class="row-fluid single-res">
          <div class="span2 offset1 attr-name">
            Description
          </div>
          <div class="span9 attr-val">
            <%= @link.description %>
          </div>
        </div>

        <div class="row-fluid single-res">
          <div class="span2 offset1 attr-name">
            Link URL
          </div>
          <div class="span9 attr-val">
            <%= link_to @link.host, @link.iframe_url, :target => "_blank" %>
          </div>
        </div>
      </div>
      <%= render "courses/vote_arrow", :link => @link %>
    </div>



    <div class="row-fluid frame-wrapper">
      <div class="span11 offset1">
        <% if @youtube_link.present? %>
          <div id="ytplayer"></div>
        <% else %>
          <iframe src="<%= @link.iframe_url %>" class="link-view">
            <p>Your browser does not support iframes.</p>
          </iframe>
        <% end %>
      </div>
    </div>
  </div>

</div>






<% content_for :js do %>
  <script type="text/javascript">
  <% if @youtube_link.present? %>
      $(document).ready(function(){
        // Load the IFrame Player API code asynchronously.
        var tag = document.createElement('script');
        tag.src = "https://www.youtube.com/player_api";
        var firstScriptTag = document.getElementsByTagName('script')[0];
        firstScriptTag.parentNode.insertBefore(tag, firstScriptTag);
        // Replace the 'ytplayer' element with an <iframe> and
        // YouTube player after the API code downloads.
      });

      var player;
      function onYouTubePlayerAPIReady() {
        player = new YT.Player('ytplayer', {
          height: '390',
          width: '640',
          videoId: get_video_id("<%= @link.url %>")
        });
      }

      function get_video_id(link_url) {
        regExp = /^.*(youtu.be\/|v\/|u\/\w\/|embed\/|watch\?v=|\&v=)([^#\&\?]*).*/;
        match = link_url.match(regExp);
        if (match&&match[2].length==11){
          return match[2];
        }else{
          return "link error";
        }
      }
  <% end %>
  </script>
<% end %>